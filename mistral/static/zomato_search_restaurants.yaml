---
version: '2.0'
zomato_search_restaurants:
  description: Search Restraurents based on address
  type: direct
  input:
  - api_server: http://172.18.0.1:8000
  - process__search_restaurants: 5ca6daac-0138-45a7-b52a-210309bdff49
  - process__publish_result: 29c392aa-4181-4ad3-acbf-860c84405795
  - headers: { 'Content-type': 'application/json' }
  - session
  - widget
  - city
  - api_key
  - widget_zomato_app: bc2d607c-c326-4f99-a50b-052420a9d19c
  tasks:
    search_restaurants:
      action: std.http
      input:
        url: "<% $.api_server %>/api/v1/widgets/<% $.widget %>/<% $.process__search_restaurants %>/"
        method: POST
        body: { "q": "<% $.city %>", "user-key": "<% $.api_key %>" }
        headers: <% $.headers %>
      publish:
        key: "<% $.widget_zomato_app %>"
        value: {
          template: 'restaurants', 
          __restaurants: <% task(search_restaurants).result.content.restaurants %>,
          __search_city: <% $.city %>
        }
      on-success:
      - publish_result
    publish_result:
      workflow: publish_feedback_to_interface widget=<% $.widget %> session=<% $.session %> key=<% $.key %> value=<% $.value %> api_server=<% $.api_server %> process__publish_result=<% $.process__publish_result %>