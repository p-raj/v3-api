---
version: '2.0'
add_admin_as_default_member:
  description: Add the User creating the organization as the member as well.
  type: direct
  input:
    - create_organization_process
    - fetch_user_profile_process
    - create_organization_member_process
    - body: {}
    - headers: {}
  tasks:
    create_organization:
      workflow: process
      input:
        url: <% $.create_organization_process %>
        method: POST
        body: <% $.body %>
        headers: <% $.headers %>
      publish:
        data: <% task(create_organization).result.data %>
        cookies: <% task(create_organization).result.cookies %>
        elapsed: <% task(create_organization).result.elapsed %>
        encoding: <% task(create_organization).result.encoding %>
        headers: <% task(create_organization).result.headers %>
        history: <% task(create_organization).result.history %>
        reason: <% task(create_organization).result.reason %>
        status: <% task(create_organization).result.status %>
        url: <% task(create_organization).result.url %>
      publish-on-error:
        data: <% task(create_organization).result.data %>
        cookies: <% task(create_organization).result.cookies %>
        elapsed: <% task(create_organization).result.elapsed %>
        encoding: <% task(create_organization).result.encoding %>
        headers: <% task(create_organization).result.headers %>
        history: <% task(create_organization).result.history %>
        reason: <% task(create_organization).result.reason %>
        status: <% task(create_organization).result.status %>
        url: <% task(create_organization).result.url %>
      on-success:
        - fetch_user_profile
    fetch_user_profile:
      workflow: process
      input:
        url: <% $.fetch_user_profile_process %>
        method: POST
        body: '{ "uuid": "<% task(create_organization).result.data.owner %>" }'
        headers: <% $.headers %>
      publish:
        data: <% task(fetch_user_profile).result.data %>
        cookies: <% task(fetch_user_profile).result.cookies %>
        elapsed: <% task(fetch_user_profile).result.elapsed %>
        encoding: <% task(fetch_user_profile).result.encoding %>
        headers: <% task(fetch_user_profile).result.headers %>
        history: <% task(fetch_user_profile).result.history %>
        reason: <% task(fetch_user_profile).result.reason %>
        status: <% task(fetch_user_profile).result.status %>
        url: <% task(fetch_user_profile).result.url %>
      publish-on-error:
        data: <% task(fetch_user_profile).result.data %>
        cookies: <% task(fetch_user_profile).result.cookies %>
        elapsed: <% task(fetch_user_profile).result.elapsed %>
        encoding: <% task(fetch_user_profile).result.encoding %>
        headers: <% task(fetch_user_profile).result.headers %>
        history: <% task(fetch_user_profile).result.history %>
        reason: <% task(fetch_user_profile).result.reason %>
        status: <% task(fetch_user_profile).result.status %>
        url: <% task(fetch_user_profile).result.url %>
      on-success:
        - add_member
    add_member:
      workflow: process
      input:
        url: <% $.create_organization_member_process %>
        method: POST
        body: '{ "name": "<% task(fetch_user_profile).result.data.name %>", "email": "<% task(fetch_user_profile).result.data.email %>", "type": "user", "owner": "<% task(create_organization).result.data.owner %>", "organization" : "<% task(create_organization).result.data.uuid %>"}'
        headers: <% $.headers %>


