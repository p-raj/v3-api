---
version: '2.0'
process_reversed:
  description: ''
  type: direct
  input:
    - url
    - process
    - headers: {}
  tasks:
    listen_for_input:
      workflow: wait_for_input
      input:
        url: <% $.url %>
        headers: <% $.headers %>
      publish:
        data: <% task(listen_for_input).result.data %>
        cookies: <% task(listen_for_input).result.cookies %>
        elapsed: <% task(listen_for_input).result.elapsed %>
        encoding: <% task(listen_for_input).result.encoding %>
        headers: <% task(listen_for_input).result.headers %>
        history: <% task(listen_for_input).result.history %>
        reason: <% task(listen_for_input).result.reason %>
        status: <% task(listen_for_input).result.status %>
        url: <% task(listen_for_input).result.url %>
      publish-on-error:
        error: <% task(listen_for_input).result.error %>
        cookies: <% task(listen_for_input).result.cookies %>
        elapsed: <% task(listen_for_input).result.elapsed %>
        encoding: <% task(listen_for_input).result.encoding %>
        headers: <% task(listen_for_input).result.headers %>
        history: <% task(listen_for_input).result.history %>
        reason: <% task(listen_for_input).result.reason %>
        status: <% task(listen_for_input).result.status %>
        url: <% task(listen_for_input).result.url %>
      retry: delay=10 count=3
      on-success:
        - original_process
    original_process:
      workflow: process
      input:
        url: <% $.process %>
        body: <% task(listen_for_input).result.data %>
        headers: <% $.headers %>
      publish:
        data: <% task(original_process).result.data %>
        cookies: <% task(original_process).result.cookies %>
        elapsed: <% task(original_process).result.elapsed %>
        encoding: <% task(original_process).result.encoding %>
        headers: <% task(original_process).result.headers %>
        history: <% task(original_process).result.history %>
        reason: <% task(original_process).result.reason %>
        status: <% task(original_process).result.status %>
        url: <% task(original_process).result.url %>
      publish-on-error:
        error: <% task(original_process).result.error %>
        cookies: <% task(original_process).result.cookies %>
        elapsed: <% task(original_process).result.elapsed %>
        encoding: <% task(original_process).result.encoding %>
        headers: <% task(original_process).result.headers %>
        history: <% task(original_process).result.history %>
        reason: <% task(original_process).result.reason %>
        status: <% task(original_process).result.status %>
        url: <% task(original_process).result.url %>
