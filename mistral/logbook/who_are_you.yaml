---
version: '2.0'
who_are_you:
  description: ''
  type: direct
  input:
    - session
    - process
  tasks:
    listen_for_input_p1-id:
      workflow: process_reversed
      input:
        url: <% $.session %>.'p1-id'
      publish:
        data: <% task(listen_for_input_p1-id).result %>
      retry: delay=10 count=100
      on-success:
        # now process_from rule may depend on user input ?
        # or may work on existing data :/
        # for existing data only
        - process_from_rule_if_any

        # a rule to mark the widget as finished
        - succeed

    process_from_rule_if_any:
      workflow: process
      input:
        url: <% $.process %>
        body: <% $.data %>
      on-success:
        - publish_data

    publish_data:
      action: std.echo output=<% $.data %>
