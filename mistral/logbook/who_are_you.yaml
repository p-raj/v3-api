---
version: '2.0'
who_are_you:
  description: ''
  type: direct
  input:
    - url
  tasks:
    listen_for_input:
      workflow: wait_for_input
      input:
        url: <% $.url %>
      publish:
        data: <% task(listen_for_input).result %>
      retry: delay=10 count=100
      on-success:
        - actual_process

    actual_process:
      workflow: process
      on-success:
        - after_process: <% $.data.len() != 0 %>

    after_process:
      workflow: process

    publish_data:
      action: std.http url='<% $.url %>resolve/name' method='POST'
      requires: [listen_for_input]
